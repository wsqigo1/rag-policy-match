# 政策匹配RAG检索系统

基于RAG（Retrieval-Augmented Generation）技术的智能政策文档匹配系统，专门针对政策查询场景优化，支持语义理解、智能过滤和精准匹配。

## 🎯 核心功能

### 智能语义匹配
- **同义词扩展**：查询"生物医药"能匹配到"医疗器械"、"制药"、"生命科学"等相关政策
- **语义理解**：理解查询意图，自动识别行业、企业规模、政策类型等维度

### 智能条件过滤
- **企业规模匹配**：初创企业查询自动过滤掉需要"注册3年以上"、"营收千万以上"等高门槛政策
- **行业精准匹配**：根据企业所属行业智能推荐最相关的政策
- **政策类型识别**：自动识别资金支持、税收优惠、人才政策等不同类型

### 混合检索技术
- **向量相似度搜索**：基于语义向量的深度匹配
- **关键词检索**：传统关键词匹配作为补充
- **RRF融合算法**：智能融合多种检索结果，提高准确性

## 🏗️ 系统架构

```
用户查询 → 查询处理引擎 → 混合检索系统 → 结果重排 → 智能分析 → 结构化输出
              ↓                ↓              ↓
         意图识别         向量数据库        政策级聚合
         查询扩展         关键词索引        适用性分析
         条件构建         多模态检索        申请建议
```

## 📋 使用示例

### 示例1：行业政策查询
**查询**：`我想查找和生物医药相关的政策`

**系统处理**：
- 自动扩展为：生物医药、医疗器械、制药、生命科学
- 匹配相关政策，按相关性排序
- 提供行业匹配度分析

**预期结果**：返回生物医药产业扶持、医疗器械创新、创新药研发等相关政策

### 示例2：企业规模智能过滤
**查询**：`我是一家小型初创企业，现阶段有什么政策比较适用`

**系统处理**：
- 识别企业规模：初创企业
- 自动过滤高门槛政策（如需要注册3年以上、营收要求等）
- 优先推荐低门槛、初创友好的政策

**预期结果**：返回初创企业专项基金、小微企业税收优惠等适合的政策

### 示例3：特定需求查询
**查询**：`有哪些研发创新方面的资金支持政策`

**系统处理**：
- 识别政策类型：资金支持 + 创新研发
- 匹配相关关键词：研发费用、创新补贴、技术攻关等
- 提供详细的申请条件和建议

## 🚀 快速开始

### 1. 环境准备
```bash
# 克隆项目
git clone <repository-url>
cd Policy-Match

# 安装依赖
pip install -r requirements.txt
```

### 2. 基础演示（无需外部依赖）
```bash
# 运行演示测试
python test_demo.py
```

### 3. 完整系统部署

#### 启动向量数据库（可选）
```bash
# Milvus
docker run -p 19530:19530 milvusdb/milvus:latest

# Elasticsearch  
docker run -p 9200:9200 -e "discovery.type=single-node" elasticsearch:8.11.0
```

#### 启动系统
```bash
# 启动完整系统
python main.py
```

#### 访问API
- API文档：http://localhost:8000/docs
- 健康检查：http://localhost:8000/health
- 系统状态：http://localhost:8000/status

## 🔧 API接口

### 政策搜索
```bash
# POST请求
curl -X POST "http://localhost:8000/search" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "我想查找和生物医药相关的政策",
    "industry": "生物医药",
    "enterprise_scale": "初创企业",
    "top_k": 5
  }'

# GET快速查询
curl "http://localhost:8000/search/quick?q=初创企业政策&enterprise_scale=初创企业"
```

### 文档上传
```bash
curl -X POST "http://localhost:8000/upload" \
  -F "file=@北京市产业政策导引.pdf"
```

### 获取示例和分类
```bash
# 查询示例
curl "http://localhost:8000/examples"

# 政策分类
curl "http://localhost:8000/categories"
```

## 📊 核心技术特性

### 文档处理
- **多格式支持**：PDF、DOCX、TXT
- **表格识别**：自动提取政策表格信息
- **智能分块**：按语义边界分割文档
- **元数据提取**：自动识别行业、规模、政策类型

### 向量化技术
- **中文优化模型**：moka-ai/m3e-base (768维)
- **多模态支持**：文本、表格、图像内容
- **查询扩展**：基于配置的同义词映射
- **向量归一化**：确保相似度计算准确性

### 检索优化
- **混合检索**：向量检索 + 关键词检索
- **RRF融合**：Reciprocal Rank Fusion算法
- **智能重排**：基于业务规则的二次排序
- **条件过滤**：多维度精准筛选

### 结果分析
- **政策级聚合**：从分块级别聚合到政策级别
- **适用性分析**：行业匹配度、规模适用性评估
- **要点提取**：自动提取核心政策要点
- **申请建议**：基于查询意图生成个性化建议

## 🎨 系统优势

### 1. 智能语义理解
- 不局限于关键词匹配，理解查询深层语义
- 自动识别同义词和相关概念
- 支持自然语言查询

### 2. 精准条件匹配
- 智能识别企业规模，避免不适用政策推荐
- 多维度条件过滤，提高匹配精度
- 个性化适用性分析

### 3. 高效混合检索
- 结合向量检索和传统检索优势
- 智能融合算法，平衡准确性和召回率
- 支持实时查询和批量处理

### 4. 结构化输出
- 提供详细的匹配分析和适用性评估
- 生成可执行的申请建议
- 支持多种输出格式

## 🔧 技术栈

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| 文档处理 | PyMuPDF + PDFPlumber | PDF解析和表格提取 |
| 向量化 | sentence-transformers | 中文文本嵌入 |
| 向量数据库 | Milvus | 高性能向量检索 |
| 搜索引擎 | Elasticsearch | 关键词和元数据检索 |
| Web框架 | FastAPI | 高性能API服务 |
| 中文处理 | jieba | 中文分词和关键词提取 |

## 📈 性能特点

- **查询响应时间**：< 2秒（包含文档解析、检索、分析）
- **支持文档量**：单系统可处理数万个政策文档
- **并发支持**：支持多用户同时查询
- **准确率**：基于语义匹配，准确率显著高于传统关键词搜索

## 🛠️ 配置说明

主要配置在 `config.py` 中：

- **模型配置**：嵌入模型、向量维度
- **数据库配置**：Milvus、Elasticsearch连接信息
- **业务配置**：行业映射、企业规模映射、政策类型映射
- **检索配置**：分块大小、检索数量、融合权重

## 🤝 扩展性

### 支持的扩展方向
1. **多语言支持**：扩展到英文、其他语言政策
2. **更多文档格式**：Word、Excel、网页等
3. **实时更新**：政策文档变更实时同步
4. **个性化推荐**：基于历史查询的个性化推荐
5. **对话式交互**：集成大语言模型，支持多轮对话

### 集成方式
- **REST API**：标准HTTP接口，易于集成
- **Python SDK**：提供Python客户端库
- **WebSocket**：支持实时推送和长连接
- **批量接口**：支持批量查询和处理

## 📝 测试验证

运行以下命令进行功能验证：

```bash
# 基础功能测试
python test_demo.py

# 完整系统测试（需要外部依赖）
python main.py
```

测试覆盖：
- ✅ 文档解析和分块
- ✅ 查询扩展和语义匹配  
- ✅ 企业规模智能过滤
- ✅ API接口完整性
- ✅ 错误处理和异常恢复

## 🎯 应用场景

1. **政府服务平台**：为企业提供政策查询和匹配服务
2. **企业服务机构**：帮助企业找到适用的扶持政策
3. **政策咨询服务**：政策解读和申请指导
4. **智能客服系统**：自动回答政策相关问题
5. **政策研究分析**：政策数据挖掘和趋势分析

---

> 💡 **注意**：当前版本基于《北京市产业政策导引.pdf》进行开发和测试，实际部署时可替换为目标地区的政策文档。

> 🚀 **快速体验**：运行 `python test_demo.py` 即可体验核心功能，无需安装额外依赖。 